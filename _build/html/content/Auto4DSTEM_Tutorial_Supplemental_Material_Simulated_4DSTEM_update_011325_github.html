
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Simulated 4dstem) &#8212; Auto4DSTEM 4 Simulated and Experimental 4DSTEM</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/Auto4DSTEM_Tutorial_Supplemental_Material_Simulated_4DSTEM_update_011325_github';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Notebook of Generating Figures in Paper Main content" href="Figure_generated_main_content_011325_github.html" />
    <link rel="prev" title="Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Experimental 4dstem)" href="Auto4DSTEM_Tutorial_Supplemental_Material_Experimental_4DSTEM_update_011325_github.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/auto4dstem_LOGO.png" class="logo__image only-light" alt="Auto4DSTEM 4 Simulated and Experimental 4DSTEM - Home"/>
    <img src="../_static/auto4dstem_LOGO.png" class="logo__image only-dark pst-js-only" alt="Auto4DSTEM 4 Simulated and Experimental 4DSTEM - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to the Auto4DSTEM Project!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Auto4DSTEM_Tutorial_Supplemental_Material_Experimental_4DSTEM_update_011325_github.html">Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Experimental 4dstem)</a></li>



<li class="toctree-l1 current active"><a class="current reference internal" href="#">Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Simulated 4dstem)</a></li>












<li class="toctree-l1"><a class="reference internal" href="Figure_generated_main_content_011325_github.html">Notebook of Generating Figures in Paper Main content</a></li>







</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/Auto4DSTEM_Tutorial_Supplemental_Material_Simulated_4DSTEM_update_011325_github.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Simulated 4dstem)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Simulated 4dstem)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-installation">Package Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-loading">Package Loading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#device-setting">Device Setting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-format">Visualization Format</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data-and-pre-trained-models">Download Data and Pre-Trained Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-mask-for-training-and-generating-results">Build mask for training and generating results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-mask">Build Mask</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmark-simulated-4dstem-dataset">Benchmark Simulated 4DSTEM Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-bkg-level-load-data-and-pre-trained-weights">Set BKG level, Load Data and Pre-Trained Weights</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-the-training-class-from-noise-free-simulated-dataset">Initialize the training class from noise-free simulated dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-pretrained-weight-to-neural-network">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-and-save-results">Generate and save results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-visual-result-class">Initialize visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-hyper-parameters-of-the-class">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-results-in-notebook">Visualize results in notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-class-and-visualize-rotation-result">Create class and visualize rotation result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-label-map">Visualize label map</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-strain-map-result">Visualize strain map result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-mae-comparison">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#noisy-4d-stem">05% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-pretraiend-weight-and-rotation-path">Load pretraiend weight and rotation path</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-train-class-parameter-for-data-generating">Update train class parameter for data generating</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-dataset">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-visual-result-class">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-variable-into-visualization-class">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reset-baseline-of-py4dstem">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shift-angle-to-compare-appropriately">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-polar-decomposition-based-on-new-affine-matrix">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Visualize strain map result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">10% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-extra-rotation-accoding-to-training-strategy">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-strain-result">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">15% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">20% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">25% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id43">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id44">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id45">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id46">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id47">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id48">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id49">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id50">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id51">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id52">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id53">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id54">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-30percent-background">Visualize 30Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id55">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id56">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id57">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id58">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id59">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id60">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id61">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id62">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id63">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id64">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id65">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id66">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-35percent-background">Visualize 35Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id67">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id68">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id69">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id70">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id71">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id72">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id73">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id74">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id75">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id76">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id77">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id78">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-40percent-background">Visualize 40Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id79">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id80">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id81">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id82">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id83">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id84">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id85">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id86">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id87">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id88">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id89">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id90">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-45percent-background">Visualize 45Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id91">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id92">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id93">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id94">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id95">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id96">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id97">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id98">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id99">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id100">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id101">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id102">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-50percent-background">Visualize 50Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id103">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id104">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id105">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id106">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id107">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id108">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id109">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id110">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id111">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id112">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id113">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id114">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-60percent-background">Visualize 60Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id115">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id116">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id117">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id118">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id119">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id120">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id121">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id122">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id123">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id124">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id125">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id126">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-70percent-background">Visualize 70Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id127">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id128">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id129">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id130">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id131">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id132">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id133">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id134">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id135">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id136">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id137">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id138">Visualize MAE comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-performance-of-both-methods">Visualize performance of both methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-various-noise-level-plots-of-both-methods">Generate various noise level plots of both methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-strain-xx-results">Generate Strain XX results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-strain-yy-results">Generate Strain YY results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-strain-xy-results">Generate Strain XY results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-rotation-results">Generate Rotation results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="extremely-noisy-4-d-stem-strain-mapping-using-cycle-consistent-spatial-transforming-autoencoders-simulated-4dstem">
<h1>Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Simulated 4dstem)<a class="headerlink" href="#extremely-noisy-4-d-stem-strain-mapping-using-cycle-consistent-spatial-transforming-autoencoders-simulated-4dstem" title="Link to this heading">#</a></h1>
<section id="package-installation">
<h2>Package Installation<a class="headerlink" href="#package-installation" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="c1">#!{sys.executable} -m pip install -i https://test.pypi.org/simple/ Auto4DSTEM==0.7.1</span>
<span class="o">!{</span>sys.executable<span class="o">}</span><span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>Auto4DSTEM
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: Auto4DSTEM in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (0.2.6)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: importlib-metadata in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (8.5.0)
Requirement already satisfied: M3learning-Util in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (2.0.3)
Requirement already satisfied: cmcrameri==1.8 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (1.8)
Requirement already satisfied: cupy-cuda12x==13.0.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (13.0.0)
Requirement already satisfied: h5py in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (3.11.0)
Requirement already satisfied: matplotlib==3.6.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (3.6.2)
Requirement already satisfied: numba==0.58.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (0.58.1)
Requirement already satisfied: numpy==1.25.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (1.25.2)
Requirement already satisfied: opencv-python-headless==4.11.0.86 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (4.11.0.86)
Requirement already satisfied: py4DSTEM==0.14.9 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (0.14.9)
Requirement already satisfied: pymatgen==2024.3.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (2024.3.1)
Requirement already satisfied: scikit-image==0.19.3 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (0.19.3)
Requirement already satisfied: scikit-learn==1.1.3 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (1.1.3)
Requirement already satisfied: scipy==1.9.3 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (1.9.3)
Requirement already satisfied: torch==2.2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (2.2.0)
Requirement already satisfied: tqdm==4.66.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (4.66.1)
Requirement already satisfied: typing_extensions==4.8.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from Auto4DSTEM) (4.8.0)
Requirement already satisfied: packaging in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from cmcrameri==1.8-&gt;Auto4DSTEM) (24.1)
Requirement already satisfied: fastrlock&gt;=0.5 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from cupy-cuda12x==13.0.0-&gt;Auto4DSTEM) (0.8.2)
Requirement already satisfied: contourpy&gt;=1.0.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from matplotlib==3.6.2-&gt;Auto4DSTEM) (1.3.0)
Requirement already satisfied: cycler&gt;=0.10 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from matplotlib==3.6.2-&gt;Auto4DSTEM) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from matplotlib==3.6.2-&gt;Auto4DSTEM) (4.53.1)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from matplotlib==3.6.2-&gt;Auto4DSTEM) (1.4.7)
Requirement already satisfied: pillow&gt;=6.2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from matplotlib==3.6.2-&gt;Auto4DSTEM) (10.4.0)
Requirement already satisfied: pyparsing&gt;=2.2.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from matplotlib==3.6.2-&gt;Auto4DSTEM) (3.1.4)
Requirement already satisfied: python-dateutil&gt;=2.7 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from matplotlib==3.6.2-&gt;Auto4DSTEM) (2.9.0.post0)
Requirement already satisfied: llvmlite&lt;0.42,&gt;=0.41.0dev0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from numba==0.58.1-&gt;Auto4DSTEM) (0.41.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: hdf5plugin&gt;=4.1.3 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (5.0.0)
Requirement already satisfied: ncempy&gt;=1.8.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (1.11.3)
Requirement already satisfied: scikit-optimize&gt;=0.9.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (0.10.2)
Requirement already satisfied: dill&gt;=0.3.3 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (0.3.8)
Requirement already satisfied: gdown&gt;=4.7.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (5.2.0)
Requirement already satisfied: dask&gt;=2.3.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (2024.9.0)
Requirement already satisfied: distributed&gt;=2.3.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (2024.9.0)
Requirement already satisfied: emdfile&gt;=0.0.14 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (0.0.15)
Requirement already satisfied: mpire&gt;=2.7.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (2.10.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (3.5.0)
Requirement already satisfied: pylops&gt;=2.1.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (2.2.0)
Requirement already satisfied: colorspacious&gt;=1.1.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from py4DSTEM==0.14.9-&gt;Auto4DSTEM) (1.1.2)
Requirement already satisfied: monty&gt;=2024.2.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (2024.7.30)
Requirement already satisfied: networkx&gt;=2.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (3.3)
Requirement already satisfied: palettable&gt;=3.1.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (3.3.3)
Requirement already satisfied: pandas in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (2.2.3)
Requirement already satisfied: plotly&gt;=4.5.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (5.24.1)
Requirement already satisfied: pybtex in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (0.24.0)
Requirement already satisfied: requests in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (2.32.3)
Requirement already satisfied: ruamel.yaml&gt;=0.17.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (0.18.6)
Requirement already satisfied: spglib&gt;=2.0.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (2.5.0)
Requirement already satisfied: sympy in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (1.13.3)
Requirement already satisfied: tabulate in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (0.9.0)
Requirement already satisfied: uncertainties&gt;=3.1.4 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (3.2.2)
Requirement already satisfied: joblib in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pymatgen==2024.3.1-&gt;Auto4DSTEM) (1.4.2)
Requirement already satisfied: imageio&gt;=2.4.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from scikit-image==0.19.3-&gt;Auto4DSTEM) (2.35.1)
Requirement already satisfied: tifffile&gt;=2019.7.26 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from scikit-image==0.19.3-&gt;Auto4DSTEM) (2024.8.30)
Requirement already satisfied: PyWavelets&gt;=1.1.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from scikit-image==0.19.3-&gt;Auto4DSTEM) (1.7.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: filelock in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (3.16.1)
Requirement already satisfied: jinja2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (3.1.4)
Requirement already satisfied: fsspec in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (2024.9.0)
Requirement already satisfied: nvidia-cuda-nvrtc-cu12==12.1.105 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (12.1.105)
Requirement already satisfied: nvidia-cuda-runtime-cu12==12.1.105 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (12.1.105)
Requirement already satisfied: nvidia-cuda-cupti-cu12==12.1.105 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (12.1.105)
Requirement already satisfied: nvidia-cudnn-cu12==8.9.2.26 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (8.9.2.26)
Requirement already satisfied: nvidia-cublas-cu12==12.1.3.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (12.1.3.1)
Requirement already satisfied: nvidia-cufft-cu12==11.0.2.54 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (11.0.2.54)
Requirement already satisfied: nvidia-curand-cu12==10.3.2.106 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (10.3.2.106)
Requirement already satisfied: nvidia-cusolver-cu12==11.4.5.107 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (11.4.5.107)
Requirement already satisfied: nvidia-cusparse-cu12==12.1.0.106 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (12.1.0.106)
Requirement already satisfied: nvidia-nccl-cu12==2.19.3 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (2.19.3)
Requirement already satisfied: nvidia-nvtx-cu12==12.1.105 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (12.1.105)
Requirement already satisfied: triton==2.2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from torch==2.2.0-&gt;Auto4DSTEM) (2.2.0)
Requirement already satisfied: nvidia-nvjitlink-cu12 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from nvidia-cusolver-cu12==11.4.5.107-&gt;torch==2.2.0-&gt;Auto4DSTEM) (12.6.68)
Requirement already satisfied: zipp&gt;=3.20 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from importlib-metadata-&gt;Auto4DSTEM) (3.20.2)
Requirement already satisfied: pygments in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (2.19.1)
Requirement already satisfied: wget in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (3.2)
Requirement already satisfied: opencv-python in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (4.10.0.84)
Requirement already satisfied: seaborn in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (0.13.2)
Requirement already satisfied: globus-cli in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (3.30.1)
Requirement already satisfied: datafed in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (3.0.0)
Requirement already satisfied: tensorflow in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (2.17.1)
Requirement already satisfied: pytest in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from M3learning-Util-&gt;Auto4DSTEM) (8.3.3)
Requirement already satisfied: click&gt;=8.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from dask&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (8.1.7)
Requirement already satisfied: cloudpickle&gt;=3.0.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from dask&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (3.0.0)
Requirement already satisfied: partd&gt;=1.4.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from dask&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (1.4.2)
Requirement already satisfied: pyyaml&gt;=5.3.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from dask&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (6.0.2)
Requirement already satisfied: toolz&gt;=0.10.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from dask&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (0.12.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: locket&gt;=1.0.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (1.0.0)
Requirement already satisfied: msgpack&gt;=1.0.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (1.1.0)
Requirement already satisfied: psutil&gt;=5.8.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (5.9.0)
Requirement already satisfied: sortedcontainers&gt;=2.0.5 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (2.4.0)
Requirement already satisfied: tblib&gt;=1.6.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (3.0.0)
Requirement already satisfied: tornado&gt;=6.2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (6.4.1)
Requirement already satisfied: urllib3&gt;=1.26.5 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (2.2.3)
Requirement already satisfied: zict&gt;=3.0.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from distributed&gt;=2.3.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (3.0.0)
Requirement already satisfied: beautifulsoup4 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from gdown&gt;=4.7.1-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (4.12.3)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: MarkupSafe&gt;=2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from jinja2-&gt;torch==2.2.0-&gt;Auto4DSTEM) (2.1.5)
Requirement already satisfied: tenacity&gt;=6.2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from plotly&gt;=4.5.0-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (9.0.0)
Requirement already satisfied: six&gt;=1.5 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib==3.6.2-&gt;Auto4DSTEM) (1.16.0)
Requirement already satisfied: ruamel.yaml.clib&gt;=0.2.7 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from ruamel.yaml&gt;=0.17.0-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (0.2.8)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pyaml&gt;=16.9 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from scikit-optimize&gt;=0.9.0-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (24.7.0)
Requirement already satisfied: prompt-toolkit&gt;=2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from datafed-&gt;M3learning-Util-&gt;Auto4DSTEM) (3.0.43)
Requirement already satisfied: protobuf&gt;=4.21.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from datafed-&gt;M3learning-Util-&gt;Auto4DSTEM) (4.25.5)
Requirement already satisfied: pyzmq&gt;=16 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from datafed-&gt;M3learning-Util-&gt;Auto4DSTEM) (25.1.2)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from requests-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from requests-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (3.10)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from requests-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (2024.8.30)
Requirement already satisfied: globus-sdk==3.44.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from globus-cli-&gt;M3learning-Util-&gt;Auto4DSTEM) (3.44.0)
Requirement already satisfied: jmespath==1.0.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from globus-cli-&gt;M3learning-Util-&gt;Auto4DSTEM) (1.0.1)
Requirement already satisfied: pyjwt&lt;3.0.0,&gt;=2.0.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pyjwt[crypto]&lt;3.0.0,&gt;=2.0.0-&gt;globus-sdk==3.44.0-&gt;globus-cli-&gt;M3learning-Util-&gt;Auto4DSTEM) (2.9.0)
Requirement already satisfied: cryptography!=3.4.0,&gt;=3.3.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from globus-sdk==3.44.0-&gt;globus-cli-&gt;M3learning-Util-&gt;Auto4DSTEM) (43.0.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytz&gt;=2020.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pandas-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pandas-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (2024.1)
Requirement already satisfied: latexcodec&gt;=1.0.4 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pybtex-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (3.0.0)
Requirement already satisfied: iniconfig in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pytest-&gt;M3learning-Util-&gt;Auto4DSTEM) (2.0.0)
Requirement already satisfied: pluggy&lt;2,&gt;=1.5 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pytest-&gt;M3learning-Util-&gt;Auto4DSTEM) (1.5.0)
Requirement already satisfied: exceptiongroup&gt;=1.0.0rc8 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pytest-&gt;M3learning-Util-&gt;Auto4DSTEM) (1.2.0)
Requirement already satisfied: tomli&gt;=1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from pytest-&gt;M3learning-Util-&gt;Auto4DSTEM) (2.0.1)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from sympy-&gt;pymatgen==2024.3.1-&gt;Auto4DSTEM) (1.3.0)
Requirement already satisfied: absl-py&gt;=1.0.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (2.1.0)
Requirement already satisfied: astunparse&gt;=1.6.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (1.6.3)
Requirement already satisfied: flatbuffers&gt;=24.3.25 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (24.3.25)
Requirement already satisfied: gast!=0.5.0,!=0.5.1,!=0.5.2,&gt;=0.2.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.6.0)
Requirement already satisfied: google-pasta&gt;=0.1.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.2.0)
Requirement already satisfied: libclang&gt;=13.0.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (18.1.1)
Requirement already satisfied: ml-dtypes&lt;0.5.0,&gt;=0.3.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.4.1)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (3.4.0)
Requirement already satisfied: setuptools in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (75.1.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (2.5.0)
Requirement already satisfied: wrapt&gt;=1.11.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (1.16.0)
Requirement already satisfied: grpcio&lt;2.0,&gt;=1.24.3 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (1.67.1)
Requirement already satisfied: tensorboard&lt;2.18,&gt;=2.17 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (2.17.1)
Requirement already satisfied: keras&gt;=3.2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (3.6.0)
Requirement already satisfied: tensorflow-io-gcs-filesystem&gt;=0.23.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.37.1)
Requirement already satisfied: wheel&lt;1.0,&gt;=0.23.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from astunparse&gt;=1.6.0-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.44.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: rich in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from keras&gt;=3.2.0-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (13.9.4)
Requirement already satisfied: namex in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from keras&gt;=3.2.0-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.0.8)
Requirement already satisfied: optree in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from keras&gt;=3.2.0-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.13.0)
Requirement already satisfied: wcwidth in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from prompt-toolkit&gt;=2-&gt;datafed-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.2.5)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: markdown&gt;=2.6.8 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorboard&lt;2.18,&gt;=2.17-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (3.7)
Requirement already satisfied: tensorboard-data-server&lt;0.8.0,&gt;=0.7.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorboard&lt;2.18,&gt;=2.17-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.7.2)
Requirement already satisfied: werkzeug&gt;=1.0.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from tensorboard&lt;2.18,&gt;=2.17-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (3.1.1)
Requirement already satisfied: soupsieve&gt;1.2 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from beautifulsoup4-&gt;gdown&gt;=4.7.1-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (2.6)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: PySocks!=1.5.7,&gt;=1.5.6 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from requests[socks]-&gt;gdown&gt;=4.7.1-&gt;py4DSTEM==0.14.9-&gt;Auto4DSTEM) (1.7.1)
Requirement already satisfied: cffi&gt;=1.12 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from cryptography!=3.4.0,&gt;=3.3.1-&gt;globus-sdk==3.44.0-&gt;globus-cli-&gt;M3learning-Util-&gt;Auto4DSTEM) (1.17.1)
Requirement already satisfied: markdown-it-py&gt;=2.2.0 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from rich-&gt;keras&gt;=3.2.0-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (3.0.0)
Requirement already satisfied: pycparser in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from cffi&gt;=1.12-&gt;cryptography!=3.4.0,&gt;=3.3.1-&gt;globus-sdk==3.44.0-&gt;globus-cli-&gt;M3learning-Util-&gt;Auto4DSTEM) (2.22)
Requirement already satisfied: mdurl~=0.1 in /home/shuyu/.conda/envs/HAWQ/lib/python3.10/site-packages (from markdown-it-py&gt;=2.2.0-&gt;rich-&gt;keras&gt;=3.2.0-&gt;tensorflow-&gt;M3learning-Util-&gt;Auto4DSTEM) (0.1.2)
</pre></div>
</div>
</div>
</div>
</section>
<section id="package-loading">
<h2>Package Loading<a class="headerlink" href="#package-loading" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pylab</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cmcrameri</span><span class="w"> </span><span class="kn">import</span> <span class="n">cm</span>
<span class="c1"># from Auto4DSTEM.src.auto4dstem.nn.Train_Function import TrainClass</span>
<span class="c1"># from Auto4DSTEM.src.auto4dstem.Viz.util import mask_class</span>
<span class="c1"># from Auto4DSTEM.src.auto4dstem.Viz.viz import set_format_Auto4D, visualize_simulate_result, visual_performance_plot,normalized_strain_matrices</span>
<span class="c1"># from m3util.util.IO import download_files_from_txt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auto4dstem.nn.Train_Function</span><span class="w"> </span><span class="kn">import</span> <span class="n">TrainClass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auto4dstem.Viz.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">mask_class</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auto4dstem.Viz.viz</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_format_Auto4D</span><span class="p">,</span> <span class="n">visualize_simulate_result</span><span class="p">,</span> <span class="n">visual_performance_plot</span><span class="p">,</span><span class="n">normalized_strain_matrices</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">m3util.util.IO</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_files_from_txt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2.2.0+cu121&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="device-setting">
<h2>Device Setting<a class="headerlink" href="#device-setting" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_DEVICE_ORDER&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;PCI_BUS_ID&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_VISIBLE_DEVICES&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;6&quot;</span>

<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using GPU&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using CPU&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using GPU
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization-format">
<h2>Visualization Format<a class="headerlink" href="#visualization-format" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">set_format</span> <span class="o">=</span> <span class="n">set_format_Auto4D</span><span class="p">()</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">set_format</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-data-and-pre-trained-models">
<h2>Download Data and Pre-Trained Models<a class="headerlink" href="#download-data-and-pre-trained-models" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder_name</span> <span class="o">=</span> <span class="s1">&#39;Simulated_4dstem/Extremely_Noisy_4DSTEM_Strain_Mapping_Using_CC_ST_AE_Simulated&#39;</span>
<span class="n">file_download</span> <span class="o">=</span>  <span class="s2">&quot;Simulated_4dstem/simulated_label_weights_affine_para&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check where are you from the root path</span>
<span class="n">download_files_from_txt</span><span class="p">(</span><span class="n">file_download</span><span class="p">,</span><span class="n">folder_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># check where are you from the root path</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">download_files_from_txt</span><span class="p">(</span><span class="n">file_download</span><span class="p">,</span><span class="n">folder_name</span><span class="p">)</span>

<span class="nn">File ~/.conda/envs/HAWQ/lib/python3.10/site-packages/m3util/util/IO.py:77,</span> in <span class="ni">download_files_from_txt</span><span class="nt">(url_file, download_path)</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">1</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="c1"># Open the text file containing URLs</span>
<span class="ne">---&gt; </span><span class="mi">77</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">url_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>     <span class="n">urls</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span> <span class="c1"># Iterate over each URL</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;Simulated_4dstem/simulated_label_weights_affine_para&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-mask-for-training-and-generating-results">
<h2>Build mask for training and generating results<a class="headerlink" href="#build-mask-for-training-and-generating-results" title="Link to this heading">#</a></h2>
<section id="build-mask">
<h3>Build Mask<a class="headerlink" href="#build-mask" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set mask class</span>
<span class="n">set_mask</span> <span class="o">=</span> <span class="n">mask_class</span><span class="p">()</span>
<span class="c1"># generate mask </span>
<span class="n">mask_tensor</span><span class="p">,</span> <span class="n">mask_list</span> <span class="o">=</span> <span class="n">set_mask</span><span class="o">.</span><span class="n">mask_ring</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">radius_2</span> <span class="o">=</span> <span class="mi">85</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="benchmark-simulated-4dstem-dataset">
<h2>Benchmark Simulated 4DSTEM Dataset<a class="headerlink" href="#benchmark-simulated-4dstem-dataset" title="Link to this heading">#</a></h2>
<section id="set-bkg-level-load-data-and-pre-trained-weights">
<h3>Set BKG level, Load Data and Pre-Trained Weights<a class="headerlink" href="#set-bkg-level-load-data-and-pre-trained-weights" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/polycrystal_output4D.mat&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="initialize-the-training-class-from-noise-free-simulated-dataset">
<h2>Initialize the training class from noise-free simulated dataset<a class="headerlink" href="#initialize-the-training-class-from-noise-free-simulated-dataset" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span> <span class="o">=</span> <span class="n">TrainClass</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span>
                <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">,</span> 
                <span class="n">transpose</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">background_weight</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">,</span>
                <span class="n">learned_rotation</span><span class="o">=</span><span class="n">rotation_path</span><span class="p">,</span>
                <span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">num_base</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">up_size</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                <span class="n">scale_limit</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                <span class="n">shear_limit</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">rotation_limit</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">trans_limit</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
                <span class="n">adj_mask_para</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">fixed_mask</span> <span class="o">=</span> <span class="n">mask_list</span><span class="p">,</span>
                <span class="n">check_mask</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">interpolate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">revise_affine</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder_name</span>
                <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/shuyu/4DSTEM/Simulated_4dstem/Extremely_Noisy_4DSTEM_Strain_Mapping_Using_CC_ST_AE_Simulated/polycrystal_output4D.mat
add image-rotation pair to whole dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:00&lt;00:00, 1586844.17it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">crop_one_image</span><span class="p">(</span><span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">4e-5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/shuyu/4DSTEM/Simulated_4dstem/Extremely_Noisy_4DSTEM_Strain_Mapping_Using_CC_ST_AE_Simulated/polycrystal_output4D.mat
</pre></div>
</div>
<img alt="../_images/de7b421c63f691d89ca25002cc756b4807f25e73e125acea8be99931edbc221a.png" src="../_images/de7b421c63f691d89ca25002cc756b4807f25e73e125acea8be99931edbc221a.png" />
</div>
</div>
<p><strong>Figure 1: One random  diffration image from 4D-STEM</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">visual_noise</span><span class="p">(</span><span class="n">noise_level</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.6</span><span class="p">],</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;simulated&#39;</span><span class="p">,</span><span class="n">add_label</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">save_format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3fd25956feae1dfa5a7902e83de3911c5d305cab2f51b944331af05d7c276ac9.png" src="../_images/3fd25956feae1dfa5a7902e83de3911c5d305cab2f51b944331af05d7c276ac9.png" />
</div>
</div>
<p><strong>Figure 2: Diffract image with various Poisson Ditributed Noise intensity. a) Raw data. b) Applied 10% noise intensity. c) 25% noise intensity. d) 45% noise intensity. e) 60% Noise Intensity.</strong></p>
</section>
<section id="load-pretrained-weight-to-neural-network">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#load-pretrained-weight-to-neural-network" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-and-save-results">
<h2>Generate and save results<a class="headerlink" href="#generate-and-save-results" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # set batch size and load dataset into DataLoader</span>
<span class="n">tc</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 256/256 [08:02&lt;00:00,  1.88s/it]
</pre></div>
</div>
</div>
</div>
</section>
<section id="initialize-visual-result-class">
<h2>Initialize visual result class<a class="headerlink" href="#initialize-visual-result-class" title="Link to this heading">#</a></h2>
<section id="set-hyper-parameters-of-the-class">
<h3>Set hyper parameters of the class<a class="headerlink" href="#set-hyper-parameters-of-the-class" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">rotation_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_clean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-results-in-notebook">
<h3>Visualize results in notebook<a class="headerlink" href="#visualize-results-in-notebook" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img_show</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">img_show</span><span class="p">:</span>
    <span class="o">%</span><span class="k">matplotlib</span> inline
<span class="k">else</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-class-and-visualize-rotation-result">
<h3>Create class and visualize rotation result<a class="headerlink" href="#create-class-and-visualize-rotation-result" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span> <span class="o">=</span> <span class="n">visualize_simulate_result</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span>  <span class="n">rotation_clean</span><span class="p">,</span>
                                <span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_clean</span><span class="p">,</span>
                                <span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="n">file_py4DSTEM</span><span class="p">,</span>
                                <span class="n">label_rotation_path</span> <span class="o">=</span> <span class="n">folder_name</span> <span class="o">+</span><span class="s1">&#39;/Label_rotation.npy&#39;</span><span class="p">,</span>
                                <span class="n">label_xx_path</span> <span class="o">=</span> <span class="n">folder_name</span> <span class="o">+</span><span class="s1">&#39;/Label_strain_xx.npy&#39;</span><span class="p">,</span>
                                <span class="n">label_yy_path</span> <span class="o">=</span> <span class="n">folder_name</span> <span class="o">+</span><span class="s1">&#39;/Label_strain_yy.npy&#39;</span><span class="p">,</span>
                                <span class="n">label_xy_path</span> <span class="o">=</span> <span class="n">folder_name</span> <span class="o">+</span><span class="s1">&#39;/Label_shear_xy.npy&#39;</span><span class="p">,</span>
                                <span class="n">cmap_rotation</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">vikO</span><span class="p">,</span>
                                <span class="n">cmap_strain</span><span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">vik</span><span class="p">,</span>
                                <span class="n">cmap_mae</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">vik</span><span class="p">,</span>
                                <span class="n">noise_intensity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="n">angle_shift</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
                                <span class="n">strain_diff_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.03</span><span class="p">],</span>
                                <span class="n">strain_rotation_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
                                <span class="n">mae_diff_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.006</span><span class="p">,</span><span class="mf">0.006</span><span class="p">],</span>
                                <span class="n">mae_rotation_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
                                <span class="n">label_style</span><span class="o">=</span> <span class="s1">&#39;b&#39;</span>
                               <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 47420.25it/s]
</pre></div>
</div>
<img alt="../_images/5d20007a7ce7eb3b2af9ca9c957243973c025054720b1fd516436456ccadf161.png" src="../_images/5d20007a7ce7eb3b2af9ca9c957243973c025054720b1fd516436456ccadf161.png" />
</div>
</div>
</section>
<section id="visualize-label-map">
<h3>Visualize label map<a class="headerlink" href="#visualize-label-map" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_label_map</span><span class="p">(</span><span class="n">cmap_strain</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">vik</span><span class="p">,</span>
                        <span class="n">cmap_rotation</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">vikO</span><span class="p">,</span>
                        <span class="n">label_style</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e80b3880e07165c025a86da1b7b61a98581362cc8c2dcbf333114a3685e32025.png" src="../_images/e80b3880e07165c025a86da1b7b61a98581362cc8c2dcbf333114a3685e32025.png" />
</div>
</div>
</section>
<section id="visualize-strain-map-result">
<h3>Visualize strain map result<a class="headerlink" href="#visualize-strain-map-result" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d15b914e87d6e11243be1b5591e22d3fd04bd6519acf5663313a147725f9b8d9.png" src="../_images/d15b914e87d6e11243be1b5591e22d3fd04bd6519acf5663313a147725f9b8d9.png" />
</div>
</div>
</section>
<section id="visualize-mae-comparison">
<h3>Visualize MAE comparison<a class="headerlink" href="#visualize-mae-comparison" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">(</span><span class="n">label_style</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d1663e4555ad857cd5c9b8097bac5bb150c927321605fa2b03da9f0960dab5e6.png" src="../_images/d1663e4555ad857cd5c9b8097bac5bb150c927321605fa2b03da9f0960dab5e6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="noisy-4d-stem">
<h1>05% Noisy 4D STEM<a class="headerlink" href="#noisy-4d-stem" title="Link to this heading">#</a></h1>
<section id="load-pretraiend-weight-and-rotation-path">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#load-pretraiend-weight-and-rotation-path" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="update-train-class-parameter-for-data-generating">
<h2>Update train class parameter for data generating<a class="headerlink" href="#update-train-class-parameter-for-data-generating" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-dataset">
<h2>Generate dataset<a class="headerlink" href="#generate-dataset" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/shuyu/4DSTEM/Simulated_4dstem/Extremely_Noisy_4DSTEM_Strain_Mapping_Using_CC_ST_AE_Simulated/polycrystal_output4D.mat
add Poison distributed background noise to whole dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [01:21&lt;00:00, 808.53it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>add image-rotation pair to whole dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:00&lt;00:00, 225803.94it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 256/256 [20:21&lt;00:00,  4.77s/it]
</pre></div>
</div>
</div>
</div>
</section>
<section id="update-visual-result-class">
<h2>Update visual result class<a class="headerlink" href="#update-visual-result-class" title="Link to this heading">#</a></h2>
<section id="id2">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_5per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_5per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-variable-into-visualization-class">
<h3>Load variable into visualization class<a class="headerlink" href="#load-variable-into-visualization-class" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_5per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_5per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reset-baseline-of-py4dstem">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#reset-baseline-of-py4dstem" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="shift-angle-to-compare-appropriately">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#shift-angle-to-compare-appropriately" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/49fbcb90be272beb8cffd07cf6bbe991487c02a301a4fbafa56ac80c21027322.png" src="../_images/49fbcb90be272beb8cffd07cf6bbe991487c02a301a4fbafa56ac80c21027322.png" />
</div>
</div>
</section>
<section id="update-polar-decomposition-based-on-new-affine-matrix">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#update-polar-decomposition-based-on-new-affine-matrix" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 46478.80it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h3>Visualize strain map result<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b1380856438a3e890d421c5ba8cf241322edc4b072b6d2d226a5cdffd8bbfe2b.png" src="../_images/b1380856438a3e890d421c5ba8cf241322edc4b072b6d2d226a5cdffd8bbfe2b.png" />
</div>
</div>
</section>
<section id="id4">
<h3>Visualize MAE comparison<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2906a6d79fb9accc3fa3ff0f0df2a650c51ee093d63076c429166d7641e569d2.png" src="../_images/2906a6d79fb9accc3fa3ff0f0df2a650c51ee093d63076c429166d7641e569d2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id5">
<h1>10% Noisy 4D STEM<a class="headerlink" href="#id5" title="Link to this heading">#</a></h1>
<section id="id6">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.10</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="add-extra-rotation-accoding-to-training-strategy">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#add-extra-rotation-accoding-to-training-strategy" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">25</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id7">
<h2>Generate dataset<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/shuyu/4DSTEM/Simulated_4dstem/Extremely_Noisy_4DSTEM_Strain_Mapping_Using_CC_ST_AE_Simulated/polycrystal_output4D.mat
add Poison distributed background noise to whole dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [01:25&lt;00:00, 769.46it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>add image-rotation pair to whole dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:00&lt;00:00, 1504243.34it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id8">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id8" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 256/256 [20:24&lt;00:00,  4.78s/it]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h2>Update visual result class<a class="headerlink" href="#id9" title="Link to this heading">#</a></h2>
<section id="id10">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.10</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_10per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_10per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id11">
<h3>Load variable into visualization class<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_10per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_10per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id12">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id13">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d5d140ea150d74d2c85d8e118dcba5e5ea3f615a78d17b0125b8c837862705f6.png" src="../_images/d5d140ea150d74d2c85d8e118dcba5e5ea3f615a78d17b0125b8c837862705f6.png" />
</div>
</div>
</section>
<section id="id14">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 46431.91it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-strain-result">
<h3>Visualize strain result<a class="headerlink" href="#visualize-strain-result" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1420787d6bc9cfe529c6a2cbeebb77a9891171cc6810553df9af326acbfbd8e8.png" src="../_images/1420787d6bc9cfe529c6a2cbeebb77a9891171cc6810553df9af326acbfbd8e8.png" />
</div>
</div>
</section>
<section id="id15">
<h3>visualize MAE comparison<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/334ff0f6cb18d56a0c94b964ee8b6d336c75e63a4fb81214b87d8bdb74a341a7.png" src="../_images/334ff0f6cb18d56a0c94b964ee8b6d336c75e63a4fb81214b87d8bdb74a341a7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id16">
<h1>15% Noisy 4D STEM<a class="headerlink" href="#id16" title="Link to this heading">#</a></h1>
<section id="id17">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id17" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id18">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id19">
<h2>Generate dataset<a class="headerlink" href="#id19" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/shuyu/4DSTEM/Simulated_4dstem/Extremely_Noisy_4DSTEM_Strain_Mapping_Using_CC_ST_AE_Simulated/polycrystal_output4D.mat
add Poison distributed background noise to whole dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [01:27&lt;00:00, 744.99it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>add image-rotation pair to whole dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:00&lt;00:00, 1547265.51it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id20">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id20" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|                                                                     | 145/256 [10:31&lt;08:03,  4.36s/it]

KeyboardInterrupt
</pre></div>
</div>
</div>
</div>
</section>
<section id="id21">
<h2>Update visual result class<a class="headerlink" href="#id21" title="Link to this heading">#</a></h2>
<section id="id22">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_15per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_15per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id23">
<h3>Load variable into visualization class<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_15per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_15per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id24">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id25">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id25" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/18e57805d10371f231bc4fe9fffc93e0ccfd5f497eb95595f72b4f3a1a042c60.png" src="../_images/18e57805d10371f231bc4fe9fffc93e0ccfd5f497eb95595f72b4f3a1a042c60.png" />
</div>
</div>
</section>
<section id="id26">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 56071.13it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id27">
<h3>Visualize strain result<a class="headerlink" href="#id27" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/85b677b89cb62ff68bcaa255b610cd7d2c4fb1abd7b41742da909e3c53c5c357.png" src="../_images/85b677b89cb62ff68bcaa255b610cd7d2c4fb1abd7b41742da909e3c53c5c357.png" />
</div>
</div>
</section>
<section id="id28">
<h3>visualize MAE comparison<a class="headerlink" href="#id28" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/14d8940ed53677e6e85e579873d4c720de5c9a198ea1eabbb57cc64fdd387357.png" src="../_images/14d8940ed53677e6e85e579873d4c720de5c9a198ea1eabbb57cc64fdd387357.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id29">
<h1>20% Noisy 4D STEM<a class="headerlink" href="#id29" title="Link to this heading">#</a></h1>
<section id="id30">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id30" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id31">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id31" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id32">
<h2>Generate dataset<a class="headerlink" href="#id32" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id33">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id33" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id34">
<h2>Update visual result class<a class="headerlink" href="#id34" title="Link to this heading">#</a></h2>
<section id="id35">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id35" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_20per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_20per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id36">
<h3>Load variable into visualization class<a class="headerlink" href="#id36" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_20per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_20per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id37">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id37" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id38">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id38" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0dd70309e2f9ded2efccb38bbdb79c5e5ee270e370efef1b19e88ea15ef9b5cf.png" src="../_images/0dd70309e2f9ded2efccb38bbdb79c5e5ee270e370efef1b19e88ea15ef9b5cf.png" />
</div>
</div>
</section>
<section id="id39">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id39" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 55830.55it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id40">
<h3>Visualize strain result<a class="headerlink" href="#id40" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f99b6639201805d9e2cfa6e671b9078a085236dfdd75029a7981c331d746188e.png" src="../_images/f99b6639201805d9e2cfa6e671b9078a085236dfdd75029a7981c331d746188e.png" />
</div>
</div>
</section>
<section id="id41">
<h3>Visualize MAE comparison<a class="headerlink" href="#id41" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a4f68d7871d7bfd1873bbbacc264b746a95fe5790f947dc10dbe43374b457904.png" src="../_images/a4f68d7871d7bfd1873bbbacc264b746a95fe5790f947dc10dbe43374b457904.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id42">
<h1>25% Noisy 4D STEM<a class="headerlink" href="#id42" title="Link to this heading">#</a></h1>
<section id="id43">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id43" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id44">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id44" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id45">
<h2>Generate dataset<a class="headerlink" href="#id45" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id46">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id46" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id47">
<h2>Update visual result class<a class="headerlink" href="#id47" title="Link to this heading">#</a></h2>
<section id="id48">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id48" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_25per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_25per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id49">
<h3>Load variable into visualization class<a class="headerlink" href="#id49" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_25per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_25per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id50">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id50" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id51">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id51" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d03d8d92d6c593f76660ad35082ff27c03c52d3b66eba02ff1c529d04af7f46e.png" src="../_images/d03d8d92d6c593f76660ad35082ff27c03c52d3b66eba02ff1c529d04af7f46e.png" />
</div>
</div>
</section>
<section id="id52">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id52" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 46307.74it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id53">
<h3>Visualize strain result<a class="headerlink" href="#id53" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/334e9688aeea4eacabf81f5e2357002b667f1f99d7a72917530e40e9772a0c19.png" src="../_images/334e9688aeea4eacabf81f5e2357002b667f1f99d7a72917530e40e9772a0c19.png" />
</div>
</div>
</section>
<section id="id54">
<h3>Visualize MAE comparison<a class="headerlink" href="#id54" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/61e055025faee9ac851b2e86f573774f3ea434ae59dc99e377557e9be8588696.png" src="../_images/61e055025faee9ac851b2e86f573774f3ea434ae59dc99e377557e9be8588696.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualize-30percent-background">
<h1>Visualize 30Percent Background<a class="headerlink" href="#visualize-30percent-background" title="Link to this heading">#</a></h1>
<section id="id55">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id55" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.30</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id56">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id56" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">30</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id57">
<h2>Generate dataset<a class="headerlink" href="#id57" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id58">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id58" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id59">
<h2>Update visual result class<a class="headerlink" href="#id59" title="Link to this heading">#</a></h2>
<section id="id60">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id60" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.30</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_30per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_30per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id61">
<h3>Load variable into visualization class<a class="headerlink" href="#id61" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_30per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_30per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id62">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id62" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id63">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id63" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8b35a2795696efa99992f54e921ceea2be218ebd1f3e343f40569ec8b7752764.png" src="../_images/8b35a2795696efa99992f54e921ceea2be218ebd1f3e343f40569ec8b7752764.png" />
</div>
</div>
</section>
<section id="id64">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id64" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 56827.06it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id65">
<h3>Visualize strain result<a class="headerlink" href="#id65" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6d9ae98ded815f37feb9822fe883221e2f017af182b31255226fe2179e997cd0.png" src="../_images/6d9ae98ded815f37feb9822fe883221e2f017af182b31255226fe2179e997cd0.png" />
</div>
</div>
</section>
<section id="id66">
<h3>Visualize MAE comparison<a class="headerlink" href="#id66" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ad2bcf2a3c3facf40994f5be637e8df00c7221188d404f4b53f09222e01e17dc.png" src="../_images/ad2bcf2a3c3facf40994f5be637e8df00c7221188d404f4b53f09222e01e17dc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualize-35percent-background">
<h1>Visualize 35Percent Background<a class="headerlink" href="#visualize-35percent-background" title="Link to this heading">#</a></h1>
<section id="id67">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id67" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id68">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id68" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id69">
<h2>Generate dataset<a class="headerlink" href="#id69" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id70">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id70" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id71">
<h2>Update visual result class<a class="headerlink" href="#id71" title="Link to this heading">#</a></h2>
<section id="id72">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id72" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_35per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_35per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id73">
<h3>Load variable into visualization class<a class="headerlink" href="#id73" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_35per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_35per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id74">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id74" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id75">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id75" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a31f32c202a1fe7de8db7a278a18259dd64f00ac6cbeb69c0713b27437a783e9.png" src="../_images/a31f32c202a1fe7de8db7a278a18259dd64f00ac6cbeb69c0713b27437a783e9.png" />
</div>
</div>
</section>
<section id="id76">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id76" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 47082.36it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id77">
<h3>Visualize strain result<a class="headerlink" href="#id77" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6d0eb59c4cc8b59554a09eecda4533c882d574a3615c89caaf34f6107b04cea5.png" src="../_images/6d0eb59c4cc8b59554a09eecda4533c882d574a3615c89caaf34f6107b04cea5.png" />
</div>
</div>
</section>
<section id="id78">
<h3>visualize MAE comparison<a class="headerlink" href="#id78" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1a2d2aeb2fc57822be699864341c8c8c9cfa8768d92fc884bd084d44859463c0.png" src="../_images/1a2d2aeb2fc57822be699864341c8c8c9cfa8768d92fc884bd084d44859463c0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualize-40percent-background">
<h1>Visualize 40Percent Background<a class="headerlink" href="#visualize-40percent-background" title="Link to this heading">#</a></h1>
<section id="id79">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id79" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id80">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id80" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">25</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id81">
<h2>Generate dataset<a class="headerlink" href="#id81" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id82">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id82" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id83">
<h2>Update visual result class<a class="headerlink" href="#id83" title="Link to this heading">#</a></h2>
<section id="id84">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id84" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_40per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_40per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id85">
<h3>Load variable into visualization class<a class="headerlink" href="#id85" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_40per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_40per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id86">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id86" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id87">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id87" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2126f0361dafa8d5bebd9c036277e1bada78239eefd6cc36a8b0a60b8ef6e08f.png" src="../_images/2126f0361dafa8d5bebd9c036277e1bada78239eefd6cc36a8b0a60b8ef6e08f.png" />
</div>
</div>
</section>
<section id="id88">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id88" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 49644.70it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id89">
<h3>Visualize strain result<a class="headerlink" href="#id89" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/73a011acd17b29faa66735ac73a82bb08d81e227518e20a9af5773d9f7a931dd.png" src="../_images/73a011acd17b29faa66735ac73a82bb08d81e227518e20a9af5773d9f7a931dd.png" />
</div>
</div>
</section>
<section id="id90">
<h3>visualize MAE comparison<a class="headerlink" href="#id90" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b7005ae1c0ef03cad391dfb16a3e97d533234551817928fc89040355c24974c1.png" src="../_images/b7005ae1c0ef03cad391dfb16a3e97d533234551817928fc89040355c24974c1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualize-45percent-background">
<h1>Visualize 45Percent Background<a class="headerlink" href="#visualize-45percent-background" title="Link to this heading">#</a></h1>
<section id="id91">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id91" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.45</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id92">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id92" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">40</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id93">
<h2>Generate dataset<a class="headerlink" href="#id93" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id94">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id94" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id95">
<h2>Update visual result class<a class="headerlink" href="#id95" title="Link to this heading">#</a></h2>
<section id="id96">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id96" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.45</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_45per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_45per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id97">
<h3>Load variable into visualization class<a class="headerlink" href="#id97" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_45per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_45per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id98">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id98" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id99">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id99" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/440e183afbe3b910ac9e5cce942cf119c8537ebd53d0d8701506b3ddba847a6e.png" src="../_images/440e183afbe3b910ac9e5cce942cf119c8537ebd53d0d8701506b3ddba847a6e.png" />
</div>
</div>
</section>
<section id="id100">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id100" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 52438.74it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id101">
<h3>Visualize strain result<a class="headerlink" href="#id101" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5a1dbc8e61aa76b02fabb473d6e4296c92ff6e029fdad42fdd6c8e5f220119ac.png" src="../_images/5a1dbc8e61aa76b02fabb473d6e4296c92ff6e029fdad42fdd6c8e5f220119ac.png" />
</div>
</div>
</section>
<section id="id102">
<h3>visualize MAE comparison<a class="headerlink" href="#id102" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ffa40be085b65e994dd5c7496fb3c91a5d8e837ba7d67d1a3f29b5cf280ae1e9.png" src="../_images/ffa40be085b65e994dd5c7496fb3c91a5d8e837ba7d67d1a3f29b5cf280ae1e9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualize-50percent-background">
<h1>Visualize 50Percent Background<a class="headerlink" href="#visualize-50percent-background" title="Link to this heading">#</a></h1>
<section id="id103">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id103" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.50</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id104">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id104" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id105">
<h2>Generate dataset<a class="headerlink" href="#id105" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id106">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id106" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id107">
<h2>Update visual result class<a class="headerlink" href="#id107" title="Link to this heading">#</a></h2>
<section id="id108">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id108" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.50</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_50per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_50per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id109">
<h3>Load variable into visualization class<a class="headerlink" href="#id109" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_50per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_50per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id110">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id110" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id111">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id111" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/af09a112df63c95f6a69eee32d7f64c64121885fa53e8b6eb858ae701a09e651.png" src="../_images/af09a112df63c95f6a69eee32d7f64c64121885fa53e8b6eb858ae701a09e651.png" />
</div>
</div>
</section>
<section id="id112">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id112" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 56021.23it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id113">
<h3>Visualize strain result<a class="headerlink" href="#id113" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/62ba5f3296600014dd7409531dfe7b42beed42015817c2dd4ac44d68137d39b9.png" src="../_images/62ba5f3296600014dd7409531dfe7b42beed42015817c2dd4ac44d68137d39b9.png" />
</div>
</div>
</section>
<section id="id114">
<h3>Visualize MAE comparison<a class="headerlink" href="#id114" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bf35f3b80288458eabacd56f1b1a3c44bd695b13cbe0a1fc2f0fe3b362be82ab.png" src="../_images/bf35f3b80288458eabacd56f1b1a3c44bd695b13cbe0a1fc2f0fe3b362be82ab.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualize-60percent-background">
<h1>Visualize 60Percent Background<a class="headerlink" href="#visualize-60percent-background" title="Link to this heading">#</a></h1>
<section id="id115">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id115" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.60</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id116">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id116" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id117">
<h2>Generate dataset<a class="headerlink" href="#id117" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id118">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id118" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id119">
<h2>Update visual result class<a class="headerlink" href="#id119" title="Link to this heading">#</a></h2>
<section id="id120">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id120" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.60</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_60per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_60per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id121">
<h3>Load variable into visualization class<a class="headerlink" href="#id121" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_60per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_60per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id122">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id122" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id123">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id123" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b505ae4773ce3d64ca082ecef118b39339de681c320d8ddf0d480c3de2fe23aa.png" src="../_images/b505ae4773ce3d64ca082ecef118b39339de681c320d8ddf0d480c3de2fe23aa.png" />
</div>
</div>
</section>
<section id="id124">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id124" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 46945.31it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id125">
<h3>Visualize strain result<a class="headerlink" href="#id125" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6bc39377731dfaa426f87c7074986c927ab8792a6cd71ee75459444387142b0d.png" src="../_images/6bc39377731dfaa426f87c7074986c927ab8792a6cd71ee75459444387142b0d.png" />
</div>
</div>
</section>
<section id="id126">
<h3>Visualize MAE comparison<a class="headerlink" href="#id126" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">mae_diff_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">]</span>
<span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b7775686a7159ed130872e69bd691c580e26224f4b798d5607cd591709648eb7.png" src="../_images/b7775686a7159ed130872e69bd691c580e26224f4b798d5607cd591709648eb7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualize-70percent-background">
<h1>Visualize 70Percent Background<a class="headerlink" href="#visualize-70percent-background" title="Link to this heading">#</a></h1>
<section id="id127">
<h2>Load pretraiend weight and rotation path<a class="headerlink" href="#id127" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.70</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Percent_pretrained_rotation.npy&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="id128">
<h3>Add extra rotation accoding to training strategy<a class="headerlink" href="#id128" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">background_weight</span><span class="o">=</span> <span class="n">bkg_intensity</span>
<span class="n">tc</span><span class="o">.</span><span class="n">learned_rotation</span> <span class="o">=</span> <span class="n">rotation_path</span>
<span class="c1"># add extra rotation accoding to training strategy</span>
<span class="n">tc</span><span class="o">.</span><span class="n">adjust_learned_rotation</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id129">
<h2>Generate dataset<a class="headerlink" href="#id129" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">reset_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id130">
<h2>Load pretrained weight to neural network<a class="headerlink" href="#id130" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s2">percent_noisy_simulated_4dstem_pretrained_weights.pkl&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">load_pretrained_weight</span><span class="p">(</span><span class="n">weight_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_process</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
           <span class="n">save_strain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">save_rotation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">bkg_intensity</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id131">
<h2>Update visual result class<a class="headerlink" href="#id131" title="Link to this heading">#</a></h2>
<section id="id132">
<h3>Set hyper parameters of the class<a class="headerlink" href="#id132" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_intensity</span> <span class="o">=</span> <span class="mf">0.70</span>
<span class="n">bkg_str</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bkg_intensity</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span><span class="s1">&#39;02d&#39;</span><span class="p">)</span>
<span class="n">rotation_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_rotation.npy&#39;</span>
<span class="n">strain_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">Per_2_train_process_scale_shear.npy&#39;</span>
<span class="n">rotation_70per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rotation_path</span><span class="p">)</span>
<span class="n">scale_shear_70per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">strain_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id133">
<h3>Load variable into visualization class<a class="headerlink" href="#id133" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">file_py4DSTEM</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/analysis_bg</span><span class="si">{</span><span class="n">bkg_str</span><span class="si">}</span><span class="s1">per_1e5counts__strain.h5&#39;</span>
<span class="n">visual</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_70per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">scale_shear</span> <span class="o">=</span> <span class="n">scale_shear_70per</span>
<span class="n">visual</span><span class="o">.</span><span class="n">noise_intensity</span> <span class="o">=</span> <span class="n">bkg_intensity</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id134">
<h3>Reset baseline of py4DSTEM<a class="headerlink" href="#id134" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_baseline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id135">
<h3>Shift angle to compare appropriately<a class="headerlink" href="#id135" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_angle</span><span class="p">(</span><span class="n">angle_shift</span><span class="o">=-</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/97e3fb9daac73f972959f85a18dc0076c9c1a9859b2fdb4be3bc09f9c1bfea88.png" src="../_images/97e3fb9daac73f972959f85a18dc0076c9c1a9859b2fdb4be3bc09f9c1bfea88.png" />
</div>
</div>
</section>
<section id="id136">
<h3>Update polar decomposition based on new affine matrix<a class="headerlink" href="#id136" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">reset_polar_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|| 65536/65536 [00:01&lt;00:00, 53125.69it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id137">
<h3>Visualize strain result<a class="headerlink" href="#id137" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">visual_strain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4abd4d9af3130553e98a9ccb0991903adb5f39bcc11ef10d420fb2577574b510.png" src="../_images/4abd4d9af3130553e98a9ccb0991903adb5f39bcc11ef10d420fb2577574b510.png" />
</div>
</div>
</section>
<section id="id138">
<h3>Visualize MAE comparison<a class="headerlink" href="#id138" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">mae_diff_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.015</span><span class="p">,</span><span class="mf">0.015</span><span class="p">]</span>
<span class="n">visual</span><span class="o">.</span><span class="n">visual_diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/37459876fbafd60ecd9bf6f8a2eb24649a096e83fa8986b35222cc41a2d6ff0e.png" src="../_images/37459876fbafd60ecd9bf6f8a2eb24649a096e83fa8986b35222cc41a2d6ff0e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">data_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">data_index_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/simulated_4dstem_grain_index.npy&#39;</span><span class="p">,</span>
                          <span class="n">show_index_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual</span><span class="o">.</span><span class="n">add_data_2_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualize-performance-of-both-methods">
<h2>Visualize performance of both methods<a class="headerlink" href="#visualize-performance-of-both-methods" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img_show</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">img_show</span><span class="p">:</span>
    <span class="o">%</span><span class="k">matplotlib</span> inline
<span class="k">else</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">direct_load</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">direct_load</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder_name</span><span class="si">}</span><span class="s1">/MAE_list_simulated_4dstem.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pickle_file</span><span class="p">:</span>
        <span class="n">visual</span><span class="o">.</span><span class="n">list_of_dic</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="generate-various-noise-level-plots-of-both-methods">
<h3>Generate various noise level plots of both methods<a class="headerlink" href="#generate-various-noise-level-plots-of-both-methods" title="Link to this heading">#</a></h3>
</section>
<section id="generate-strain-xx-results">
<h3>Generate Strain XX results<a class="headerlink" href="#generate-strain-xx-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># maually_record_fpga_results</span>

<span class="c1"># x_add = [0,0.25,0.6]</span>
<span class="c1"># fpga_xx = [0.002,0.0017,0.0019]</span>
<span class="c1"># fpga_yy = [0.0026,0.0017,0.0022]</span>
<span class="c1"># fpga_xy = [0.0015,0.0011,0.0016]</span>
<span class="c1"># fpga_rot = [1.63,1.28,1.47]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual_performance_plot</span><span class="p">(</span><span class="n">x_list</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">auto</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">py4d</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
<span class="c1">#                         auto_yerr =visual.extract_ele_from_dic(12)[1],</span>
<span class="c1">#                         py4d_yerr =visual.extract_ele_from_dic(8)[1],</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Strian X&#39;</span><span class="p">,</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">ylabel</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="c1"># add_x = x_add,</span>
                        <span class="c1"># add_y = fpga_xx,</span>
                        <span class="n">marker_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.005</span><span class="p">],</span>
                        <span class="n">fill_between</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">errorbar</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">folder_path</span><span class="o">=</span><span class="s1">&#39;save_figures/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4573be1d7019c175bb2fbcdb03741b9a4fe042f1212c28ccb711f31684364d0f.png" src="../_images/4573be1d7019c175bb2fbcdb03741b9a4fe042f1212c28ccb711f31684364d0f.png" />
</div>
</div>
</section>
<section id="generate-strain-yy-results">
<h3>Generate Strain YY results<a class="headerlink" href="#generate-strain-yy-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual_performance_plot</span><span class="p">(</span><span class="n">x_list</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">auto</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">5</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">py4d</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="c1"># auto_yerr =visual.extract_ele_from_dic(13)[1],</span>
                        <span class="c1"># py4d_yerr =visual.extract_ele_from_dic(9)[1],</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Strian Y&#39;</span><span class="p">,</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">ylabel</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="c1"># add_x = x_add,</span>
                        <span class="c1"># add_y = fpga_yy,</span>
                        <span class="n">marker_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.005</span><span class="p">],</span>
                        <span class="n">fill_between</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">errorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">folder_path</span><span class="o">=</span><span class="s1">&#39;save_figures/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ba00dbf3b1d40971ceb8a08e6fc5880e825e98df4831edab6738b7a5ad0c9ea2.png" src="../_images/ba00dbf3b1d40971ceb8a08e6fc5880e825e98df4831edab6738b7a5ad0c9ea2.png" />
</div>
</div>
</section>
<section id="generate-strain-xy-results">
<h3>Generate Strain XY results<a class="headerlink" href="#generate-strain-xy-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual_performance_plot</span><span class="p">(</span><span class="n">x_list</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">auto</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">py4d</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="c1"># auto_yerr =visual.extract_ele_from_dic(14)[1],</span>
                        <span class="c1"># py4d_yerr =visual.extract_ele_from_dic(10)[1],</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Shear&#39;</span><span class="p">,</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">ylabel</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="c1"># add_x = x_add,</span>
                        <span class="c1"># add_y = fpga_xy,</span>
                        <span class="n">marker_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.004</span><span class="p">],</span>
                        <span class="n">fill_between</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">errorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">folder_path</span><span class="o">=</span><span class="s1">&#39;save_figures/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2679dfd75dd19663c4fa993d3528dd1ca16682b8d14b40b009d119ac3e97a0ae.png" src="../_images/2679dfd75dd19663c4fa993d3528dd1ca16682b8d14b40b009d119ac3e97a0ae.png" />
</div>
</div>
</section>
<section id="generate-rotation-results">
<h3>Generate Rotation results<a class="headerlink" href="#generate-rotation-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visual_performance_plot</span><span class="p">(</span><span class="n">x_list</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">auto</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">7</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">py4d</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">extract_ele_from_dic</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="c1"># auto_yerr =visual.extract_ele_from_dic(15)[1],</span>
                        <span class="c1"># py4d_yerr =visual.extract_ele_from_dic(11)[1],</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Rotation&#39;</span><span class="p">,</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">ylabel</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="c1"># add_x = x_add,</span>
                        <span class="c1"># add_y = fpga_rot,</span>
                        <span class="n">marker_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.75</span><span class="p">],</span>
                        <span class="n">fill_between</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">errorbar</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">folder_path</span><span class="o">=</span><span class="s1">&#39;save_figures/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4ff6e1f54dcd4baeca82bad2551bd53641b9cafca31f52a6f42c63938b737ccd.png" src="../_images/4ff6e1f54dcd4baeca82bad2551bd53641b9cafca31f52a6f42c63938b737ccd.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "hawq"
        },
        kernelOptions: {
            name: "hawq",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'hawq'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Auto4DSTEM_Tutorial_Supplemental_Material_Experimental_4DSTEM_update_011325_github.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Experimental 4dstem)</p>
      </div>
    </a>
    <a class="right-next"
       href="Figure_generated_main_content_011325_github.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebook of Generating Figures in Paper Main content</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Extremely Noisy 4-D STEM Strain Mapping Using Cycle Consistent Spatial Transforming Autoencoders (Simulated 4dstem)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-installation">Package Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-loading">Package Loading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#device-setting">Device Setting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-format">Visualization Format</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data-and-pre-trained-models">Download Data and Pre-Trained Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-mask-for-training-and-generating-results">Build mask for training and generating results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-mask">Build Mask</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmark-simulated-4dstem-dataset">Benchmark Simulated 4DSTEM Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-bkg-level-load-data-and-pre-trained-weights">Set BKG level, Load Data and Pre-Trained Weights</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-the-training-class-from-noise-free-simulated-dataset">Initialize the training class from noise-free simulated dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-pretrained-weight-to-neural-network">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-and-save-results">Generate and save results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-visual-result-class">Initialize visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-hyper-parameters-of-the-class">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-results-in-notebook">Visualize results in notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-class-and-visualize-rotation-result">Create class and visualize rotation result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-label-map">Visualize label map</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-strain-map-result">Visualize strain map result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-mae-comparison">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#noisy-4d-stem">05% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-pretraiend-weight-and-rotation-path">Load pretraiend weight and rotation path</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-train-class-parameter-for-data-generating">Update train class parameter for data generating</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-dataset">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-visual-result-class">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-variable-into-visualization-class">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reset-baseline-of-py4dstem">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shift-angle-to-compare-appropriately">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-polar-decomposition-based-on-new-affine-matrix">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Visualize strain map result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">10% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-extra-rotation-accoding-to-training-strategy">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-strain-result">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">15% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">20% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">25% Noisy 4D STEM</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id43">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id44">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id45">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id46">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id47">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id48">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id49">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id50">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id51">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id52">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id53">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id54">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-30percent-background">Visualize 30Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id55">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id56">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id57">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id58">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id59">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id60">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id61">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id62">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id63">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id64">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id65">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id66">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-35percent-background">Visualize 35Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id67">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id68">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id69">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id70">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id71">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id72">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id73">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id74">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id75">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id76">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id77">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id78">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-40percent-background">Visualize 40Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id79">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id80">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id81">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id82">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id83">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id84">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id85">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id86">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id87">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id88">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id89">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id90">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-45percent-background">Visualize 45Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id91">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id92">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id93">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id94">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id95">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id96">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id97">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id98">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id99">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id100">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id101">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id102">visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-50percent-background">Visualize 50Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id103">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id104">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id105">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id106">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id107">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id108">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id109">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id110">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id111">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id112">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id113">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id114">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-60percent-background">Visualize 60Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id115">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id116">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id117">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id118">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id119">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id120">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id121">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id122">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id123">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id124">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id125">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id126">Visualize MAE comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-70percent-background">Visualize 70Percent Background</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id127">Load pretraiend weight and rotation path</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id128">Add extra rotation accoding to training strategy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id129">Generate dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id130">Load pretrained weight to neural network</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id131">Update visual result class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id132">Set hyper parameters of the class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id133">Load variable into visualization class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id134">Reset baseline of py4DSTEM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id135">Shift angle to compare appropriately</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id136">Update polar decomposition based on new affine matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id137">Visualize strain result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id138">Visualize MAE comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-performance-of-both-methods">Visualize performance of both methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-various-noise-level-plots-of-both-methods">Generate various noise level plots of both methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-strain-xx-results">Generate Strain XX results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-strain-yy-results">Generate Strain YY results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-strain-xy-results">Generate Strain XY results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-rotation-results">Generate Rotation results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Shuyu Qin, Joshua Agar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>